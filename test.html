<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾²å¥½äº‹ï½è—¥åŠ‘è‚¥æ–™ç¨€é‡‹è¼•é¬†ç®—</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f7f4;
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            justify_content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            padding: 25px;
            box-sizing: border-box;
        }

        h1 {
            color: #2e7d32;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
            line-height: 1.2;
        }

        /* --- åˆ†é åˆ‡æ›æŒ‰éˆ• --- */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #2e7d32;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background-color: white;
            color: #2e7d32;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .tab-btn.active {
            background-color: #2e7d32;
            color: white;
        }

        /* --- è¼¸å…¥å€å¡Š --- */
        .form-group { margin-bottom: 20px; }
        
        label {
            display: block;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #1b5e20;
        }

        select, input[type="number"] {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #a5d6a7;
            border-radius: 10px;
            box-sizing: border-box;
            background-color: #fff;
        }
        
        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
        .hidden { display: none; }

        /* --- çµæœé¡¯ç¤ºå€ --- */
        .result-box {
            background-color: #e8f5e9;
            border: 2px dashed #66bb6a;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }
        .result-value { font-size: 2.5rem; font-weight: bold; color: #c62828; display: block; }
        .result-unit { font-size: 1.1rem; color: #333; }

        /* --- æ”¶è—èˆ‡åˆ†äº«æŒ‰éˆ•å€ --- */
        .action-area {
            margin-top: 25px;
            border-top: 1px solid #eee;
            padding-top: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn-action {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            min-width: 120px;
            font-weight: bold;
        }

        .btn-line {
            background-color: #06c755;
            color: white;
        }

        .btn-copy {
            background-color: #607d8b;
            color: white;
        }

        .btn-pwa {
            background-color: #ff9800;
            color: white;
            width: 100%; /* PWA æŒ‰éˆ•ç¨ä½”ä¸€è¡Œ */
            display: none; /* é è¨­éš±è— */
        }

        .toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 50px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 17px;
        }
        .toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }

        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }

    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸŒ± è¾²å¥½äº‹<br><span style="font-size:0.8em; color:#666;">è—¥åŠ‘è‚¥æ–™ç¨€é‡‹è¼•é¬†ç®—</span></h1>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchMode('select')" id="tab-select">å¸¸ç”¨é€ŸæŸ¥</button>
            <button class="tab-btn" onclick="switchMode('custom')" id="tab-custom">è‡ªè¡Œè¼¸å…¥</button>
        </div>

        <div id="panel-select">
            <div class="form-group">
                <label>ç¨€é‡‹å€æ•¸</label>
                <select id="dilution" onchange="calculate()">
                    <option value="500">500 å€</option>
                    <option value="800">800 å€</option>
                    <option value="1000" selected>1000 å€</option>
                    <option value="1500">1500 å€</option>
                    <option value="2000">2000 å€</option>
                    <option value="3000">3000 å€</option>
                    </select>
            </div>
            <div class="form-group">
                <label>ç”¨æ°´é‡</label>
                <select id="water" onchange="calculate()">
                    <option value="16" selected>16 å…¬å‡ (èƒŒæ¡¶)</option>
                    <option value="20">20 å…¬å‡</option>
                    <option value="25">25 å…¬å‡ (å‹•åŠ›æ¡¶)</option>
                    <option value="200">200 å…¬å‡</option>
                    <option value="1000">1000 å…¬å‡ (ä¸€å™¸)</option>
                </select>
            </div>
        </div>

        <div id="panel-custom" class="hidden">
            <div class="form-group">
                <label>è¼¸å…¥ç¨€é‡‹å€æ•¸</label>
                <input type="number" id="custom-dilution" placeholder="ä¾‹ï¼š450" oninput="calculate()">
            </div>
            <div class="form-group">
                <label>è¼¸å…¥ç”¨æ°´é‡ (å…¬å‡)</label>
                <input type="number" id="custom-water" placeholder="ä¾‹ï¼š100" oninput="calculate()">
            </div>
        </div>

        <div class="result-box">
            <div class="result-title">è«‹åŠ å…¥è—¥åŠ‘ / è‚¥æ–™</div>
            <span id="resultValue" class="result-value">0</span>
            <span class="result-unit">æ¯«å‡(cc) æˆ– å…¬å…‹(g)</span>
        </div>
<div id="installContainer">
            <button id="installBtn">ğŸ“² ä¸‹è¼‰ App åˆ°æ¡Œé¢</button>
        </div>

        <div id="iosInstallPrompt">
            <strong>ğŸ iPhone ç”¨æˆ¶è«‹é€™æ¨£åšï¼š</strong><br>
            1. é»æ“Šä¸‹æ–¹ç€è¦½å™¨çš„ <img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxNCIgaGVpZ2h0PSIxNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDdlZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIj48cGF0aCBkPSJNMyAxMnY4YzAgMS4xLjk5NiAyIDIuMDExIDIuMDAxaDEzLjk3OEMyMC4wMDggMjIgMjEgMjEuMSAyMSAyMHYtOCIvPjxwb2x5bGluZSBwb2ludHM9IjE2IDYgMTIgMiA4IDYiLz48bGluZSB4MT0iMTIiIHkxPSIyIiB4Mj0iMTIiIHkyPSIxNSIvPjwvc3ZnPg==" style="vertical-align:middle"> <strong>åˆ†äº«æŒ‰éˆ•</strong><br>
            2. æ»‘å‹•é¸å–®æ‰¾åˆ°ä¸¦é»é¸ <strong>ã€ŒåŠ å…¥ä¸»ç•«é¢ã€</strong> å³å¯ã€‚
        </div>
        <div class="action-area">
            <button class="btn-action btn-line" onclick="shareToLine()">
                Line æ”¶è—
            </button>
            
            <button class="btn-action btn-copy" onclick="copyLink()">
                è¤‡è£½é€£çµ
            </button>

            <button id="installBtn" class="btn-action btn-pwa">
                ğŸ“² åŠ å…¥æ‰‹æ©Ÿæ¡Œé¢
            </button>
        </div>

        <div style="text-align:center; margin-top:15px; color:#888; font-size:0.8rem;">
            è¾²ä½œè¨ˆç®—å°å¹«æ‰‹ | è‡ªå‹•è¨˜æ†¶ä¸Šæ¬¡è¼¸å…¥
        </div>
    </div>

    <div id="toast" class="toast">ç¶²å€å·²è¤‡è£½ï¼</div>

    <script>
        let currentMode = 'select';

        // åˆå§‹åŒ–ï¼šè®€å–ä¸Šæ¬¡çš„ç´€éŒ„
        window.onload = function() {
            loadSettings();
            calculate();
        };

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('tab-select').classList.toggle('active', mode === 'select');
            document.getElementById('tab-custom').classList.toggle('active', mode === 'custom');
            
            if (mode === 'select') {
                document.getElementById('panel-select').classList.remove('hidden');
                document.getElementById('panel-custom').classList.add('hidden');
            } else {
                document.getElementById('panel-select').classList.add('hidden');
                document.getElementById('panel-custom').classList.remove('hidden');
            }
            calculate();
        }

        function calculate() {
            let dilution, water;

            if (currentMode === 'select') {
                dilution = parseFloat(document.getElementById('dilution').value);
                water = parseFloat(document.getElementById('water').value);
                // å„²å­˜è¨­å®š
                localStorage.setItem('saved_mode', 'select');
                localStorage.setItem('saved_dilution_select', dilution);
                localStorage.setItem('saved_water_select', water);
            } else {
                dilution = parseFloat(document.getElementById('custom-dilution').value);
                water = parseFloat(document.getElementById('custom-water').value);
                // å„²å­˜è¨­å®š
                localStorage.setItem('saved_mode', 'custom');
                if(dilution) localStorage.setItem('saved_dilution_custom', dilution);
                if(water) localStorage.setItem('saved_water_custom', water);
            }

            if (!dilution || !water || dilution === 0) {
                document.getElementById('resultValue').innerText = "0";
                return;
            }

            let result = (water * 1000) / dilution;
            let displayResult = (result < 1) ? result.toFixed(3) : (Number.isInteger(result) ? result : result.toFixed(1));
            document.getElementById('resultValue').innerText = displayResult;
        }

        // è®€å–æ­·å²è¨­å®š
        function loadSettings() {
            const mode = localStorage.getItem('saved_mode');
            if (mode === 'custom') {
                switchMode('custom');
                document.getElementById('custom-dilution').value = localStorage.getItem('saved_dilution_custom') || '';
                document.getElementById('custom-water').value = localStorage.getItem('saved_water_custom') || '';
            } else {
                // é è¨­ Select æ¨¡å¼
                const savedDil = localStorage.getItem('saved_dilution_select');
                const savedWater = localStorage.getItem('saved_water_select');
                if (savedDil) document.getElementById('dilution').value = savedDil;
                if (savedWater) document.getElementById('water').value = savedWater;
            }
        }

        // --- åˆ†äº«åŠŸèƒ½ ---
        function shareToLine() {
            // å–å¾—ç›®å‰ç¶²å€
            const url = encodeURIComponent(window.location.href);
            // æª¢æŸ¥æ˜¯å¦æ˜¯æœ¬åœ°æª”æ¡ˆ
            if (window.location.protocol === 'file:') {
                alert("è«‹å…ˆå°‡ç¶²é ä¸Šå‚³åˆ°ç¶²è·¯ç©ºé–“ï¼Œæ‰èƒ½ä½¿ç”¨ Line åˆ†äº«å–”ï¼");
                return;
            }
            // é–‹å•Ÿ Line åˆ†äº«é é¢
            window.open('https://line.me/R/msg/text/?' + url + '%0Aè¾²å¥½äº‹-è—¥åŠ‘è‚¥æ–™è¨ˆç®—æ©Ÿ', '_blank');
        }

        function copyLink() {
            const dummy = document.createElement('input');
            const text = window.location.href;
            document.body.appendChild(dummy);
            dummy.value = text;
            dummy.select();
            document.execCommand('copy');
            document.body.removeChild(dummy);
            
            showToast();
        }

        function showToast() {
            const x = document.getElementById("toast");
            x.className = "toast show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        // --- PWA å®‰è£é‚è¼¯ ---
        let deferredPrompt;
        const installBtn = document.getElementById('installBtn');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block'; // æœ‰æ”¯æ´æ‰é¡¯ç¤º
        });

        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installBtn.style.display = 'none';
                }
                deferredPrompt = null;
            }
        });
    </script>
</body>
</html>
