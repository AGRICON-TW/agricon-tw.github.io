<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¾²å¥½äº‹ï½è—¥åŠ‘è‚¥æ–™è¼•é¬†ç®—</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-capable" content="yes">

    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f0f7f4;
            margin: 0;
            padding: 20px;
            color: #333;
            display: flex;
            justify_content: center;
            align-items: center;
            min-height: 100vh;
        }

        .container {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 500px;
            padding: 25px;
            box-sizing: border-box;
        }

        h1 {
            color: #2e7d32;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
            line-height: 1.2;
        }

        /* --- åˆ†é åˆ‡æ›æŒ‰éˆ• (Tabs) --- */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #2e7d32;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background-color: white;
            color: #2e7d32;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .tab-btn.active {
            background-color: #2e7d32;
            color: white;
        }

        /* --- è¼¸å…¥å€å¡Šæ¨£å¼ --- */
        .form-group { margin-bottom: 20px; }
        
        label {
            display: block;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: #1b5e20;
        }

        /* ä¸‹æ‹‰é¸å–®æ¨£å¼ */
        select {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #a5d6a7;
            border-radius: 10px;
            background-color: #fff;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232e7d32' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.5em;
        }

        /* è‡ªè¡Œè¼¸å…¥æ¡†æ¨£å¼ */
        input[type="number"] {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 2px solid #2e7d32;
            border-radius: 10px;
            box-sizing: border-box; /* ç¢ºä¿å¯¬åº¦åŒ…å«é‚Šæ¡† */
            background-color: #f9fff9;
        }

        input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.3);
        }

        /* éš±è—/é¡¯ç¤ºæ§åˆ¶ */
        .hidden { display: none; }

        /* --- çµæœé¡¯ç¤ºå€ --- */
        .result-box {
            background-color: #e8f5e9;
            border: 2px dashed #66bb6a;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }

        .result-title { font-size: 1.1rem; color: #555; margin-bottom: 5px; }
        .result-value { font-size: 2.5rem; font-weight: bold; color: #c62828; display: block; }
        .result-unit { font-size: 1.1rem; color: #333; }

        .calc-btn {
            width: 100%;
            background-color: #2e7d32;
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.3rem;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 10px;
        }

        /* PWA å®‰è£æŒ‰éˆ•å€ */
        #installContainer {
            margin-top: 20px;
            text-align: center;
            display: none;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }
        #installBtn {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 1rem;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸŒ± è¾²å¥½äº‹<br><span style="font-size:0.8em; color:#666;">è—¥åŠ‘è‚¥æ–™è¼•é¬†ç®—</span></h1>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchMode('select')" id="tab-select">å¸¸ç”¨é€ŸæŸ¥</button>
            <button class="tab-btn" onclick="switchMode('custom')" id="tab-custom">è‡ªè¡Œè¼¸å…¥</button>
        </div>

        <div id="panel-select">
            <div class="form-group">
                <label>ç¨€é‡‹å€æ•¸</label>
                <select id="dilution" onchange="calculate()">
                    <option value="100">100 å€</option>
                    <option value="200">200 å€</option>
                    <option value="300">300 å€</option>
                    <option value="400">400 å€</option>
                    <option value="500">500 å€</option>
                    <option value="800">800 å€</option>
                    <option value="1000" selected>1000 å€ (é è¨­)</option>
                    <option value="1500">1500 å€</option>
                    <option value="2000">2000 å€</option>
                    <option value="3000">3000 å€</option>
                    <option value="5000">5000 å€</option>
                    <option value="10000">10000 å€</option>
                    <option value="20000">20000 å€</option>
                    <option value="50000">50000 å€</option>
                </select>
            </div>
            <div class="form-group">
                <label>ç”¨æ°´é‡ (å…¬å‡)</label>
                <select id="water" onchange="calculate()">
                    <option value="10">10 å…¬å‡</option>
                    <option value="16" selected>16 å…¬å‡ (èƒŒæ¡¶)</option>
                    <option value="20">20 å…¬å‡</option>
                    <option value="25">25 å…¬å‡ (å‹•åŠ›æ¡¶)</option>
                    <option value="120">120 å…¬å‡</option>
                    <option value="200">200 å…¬å‡ (å¤§æ¡¶)</option>
                    <option value="300">300 å…¬å‡</option>
                    <option value="500">500 å…¬å‡</option>
                    <option value="1000">1000 å…¬å‡ (ä¸€å™¸)</option>
                </select>
            </div>
        </div>

        <div id="panel-custom" class="hidden">
            <div class="form-group">
                <label>è«‹è¼¸å…¥ç¨€é‡‹å€æ•¸</label>
                <input type="number" id="custom-dilution" placeholder="ä¾‹å¦‚ï¼š450" oninput="calculate()">
            </div>
            <div class="form-group">
                <label>è«‹è¼¸å…¥ç”¨æ°´é‡ (å…¬å‡)</label>
                <input type="number" id="custom-water" placeholder="ä¾‹å¦‚ï¼š100" oninput="calculate()">
            </div>
        </div>

        <button class="calc-btn" onclick="calculate()">è¨ˆç®—ä½¿ç”¨é‡</button>

        <div class="result-box">
            <div class="result-title">è«‹åŠ å…¥è—¥åŠ‘ / è‚¥æ–™</div>
            <span id="resultValue" class="result-value">0</span>
            <span class="result-unit">æ¯«å‡(cc) æˆ– å…¬å…‹(g)</span>
        </div>

        <div id="installContainer">
            <button id="installBtn">ğŸ“² ä¸‹è¼‰ App åˆ°æ¡Œé¢</button>
        </div>

        <div style="text-align:center; margin-top:20px; color:#888; font-size:0.9rem;">
            è¾²ä½œè¨ˆç®—å°å¹«æ‰‹ | é©ç”¨æ–¼æ¶²é«”èˆ‡ç²‰åŠ‘
        </div>
    </div>

    <script>
        // è¿½è¹¤ç•¶å‰æ¨¡å¼ï¼š'select' æˆ– 'custom'
        let currentMode = 'select';

        function switchMode(mode) {
            currentMode = mode;
            
            // åˆ‡æ›æŒ‰éˆ•æ¨£å¼
            document.getElementById('tab-select').classList.toggle('active', mode === 'select');
            document.getElementById('tab-custom').classList.toggle('active', mode === 'custom');

            // åˆ‡æ›é¡¯ç¤ºå€å¡Š
            if (mode === 'select') {
                document.getElementById('panel-select').classList.remove('hidden');
                document.getElementById('panel-custom').classList.add('hidden');
            } else {
                document.getElementById('panel-select').classList.add('hidden');
                document.getElementById('panel-custom').classList.remove('hidden');
            }
            
            // åˆ‡æ›æ™‚é‡æ–°è¨ˆç®—
            calculate();
        }

        function calculate() {
            let dilution, water;

            if (currentMode === 'select') {
                // å¾ä¸‹æ‹‰é¸å–®å–å€¼
                dilution = parseFloat(document.getElementById('dilution').value);
                water = parseFloat(document.getElementById('water').value);
            } else {
                // å¾è¼¸å…¥æ¡†å–å€¼
                dilution = parseFloat(document.getElementById('custom-dilution').value);
                water = parseFloat(document.getElementById('custom-water').value);
            }

            // é˜²å‘†ï¼šå¦‚æœæ•¸å­—ä¸å®Œæ•´æˆ–ç‚º0ï¼Œé¡¯ç¤º0
            if (!dilution || !water || dilution === 0) {
                document.getElementById('resultValue').innerText = "0";
                return;
            }

            // è¨ˆç®—å…¬å¼
            let result = (water * 1000) / dilution;

            // é¡¯ç¤ºé‚è¼¯
            let displayResult;
            if (result < 1) {
                displayResult = result.toFixed(3);
            } else if (Number.isInteger(result)) {
                displayResult = result;
            } else {
                displayResult = result.toFixed(1);
            }

            document.getElementById('resultValue').innerText = displayResult;
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œä¸€æ¬¡
        window.onload = calculate;

        // --- PWA å®‰è£é‚è¼¯ (èˆ‡ä¹‹å‰ç›¸åŒ) ---
        let deferredPrompt;
        const installContainer = document.getElementById('installContainer');

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installContainer.style.display = 'block';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installContainer.style.display = 'none';
                }
                deferredPrompt = null;
            }
        });
    </script>
</body>
</html>
